================================================================================
ONE-UPPER PROJECT SUMMARY
Updated: November 24, 2025
================================================================================

WHAT IS ONE-UPPER?
--------------------------------------------------------------------------------
A competitive 1v1 async mobile game where players engage in escalating creative 
duels judged by AI personalities. Players compete in 11-show rivalries, answering 
the same prompts with witty responses. AI judges score each answer, and whoever 
wins the most shows claims the Golden Mic.

Live at: oneupper.app

--------------------------------------------------------------------------------
TECH STACK
--------------------------------------------------------------------------------
Frontend:       React 18 + Vite
Backend:        Supabase (PostgreSQL + Edge Functions + Realtime)
AI:             Claude Sonnet 4 via Anthropic API
Deployment:     Vercel (auto-deploy from GitHub)
Domain:         oneupper.app (DirectNIC DNS)
SMS:            Twilio (built but disabled pending A2P 10DLC registration)

--------------------------------------------------------------------------------
CURRENT STATE (What's Working)
--------------------------------------------------------------------------------

CORE GAMEPLAY âœ…
- 11-show fixed rivalries (was infinite, now has defined end)
- Real-time multiplayer sync via Supabase Realtime
- Complete judging system with 25 AI judge personalities
- Each show: prompt â†’ both answer â†’ AI judges â†’ verdict â†’ next show
- Show numbering displays "Show X of 11"
- Special Ripley emcee lines for shows 9, 10, 11 (tension building)
- No auto-advance after show 11 (prevents race conditions)

RIVALRY SUMMARY SCREEN âœ…
- Appears after show 11 completes
- Golden mic SVG for winner only (loser sees no mic)
- AI-generated rivalry analysis (narrative about the arc)
- Player style descriptions (one sentence each)
- Memorable moments (clean paragraphs, no bullets)
- Score totals verified accurate (137-136 example confirmed)
- "See Past Shows" collapsible section
- Dedicated Screen6Summary for viewing past shows from summary
- "Return to Summary" button works correctly
- "Start a New Rivalry" button (was "Challenge a Friend")
- "Share Summary" button (copies text to clipboard)
- "Skip Summary & Go Home" on error
- Race condition prevention (status='summarizing' lock)

UI/UX POLISH âœ…
- Judge view resets to "scores" on each new show
- Landing page updated for 11-show format
- How To Play modal updated for 11-show format
- Confetti celebrations on wins
- Milestone streak indicators
- Clean visual hierarchy (mobile-first)
- Ripley emcee interstitials between shows

PROFILES & RIVALRIES âœ…
- Profile creation with name, avatar, phone (optional)
- Unique 6-character profile codes for challenging
- One active rivalry per profile pair (constraint enforced)
- Rivalry cancellation with confirmation

AI FEATURES âœ…
- 25 distinct judge personalities with varied scoring criteria
- Judge banter (conversational commentary)
- Rivalry commentary (meta-analysis from one judge per show)
- Artifacts: Celebrity Match, Fake Headline, Fact Check
- Brain Boost tips after each verdict
- Summary generation with scores, analysis, player styles, moments

INFRASTRUCTURE âœ…
- Edge functions: judge-show, select-emcee-line, summarize-rivalry, send-sms
- Database migrations for 11-show support
- Error handling with retry logic
- Score parsing fixed (handles multiple key formats, defaults to 5)
- Privacy Policy and Terms of Service pages
- Judges gallery page

--------------------------------------------------------------------------------
KNOWN ISSUES / BUGS
--------------------------------------------------------------------------------

1. JUDGE SCORES SOMETIMES MISSING
   - Shows 6 and 10 in test rivalry had no numeric scores (only comments)
   - Bug in judge-show: Claude sometimes returns comments without scores
   - FIXED: Added fallback parsing + default to 5 if undefined
   - Deployed: judge-show with validation
   - Status: Should be fixed going forward, old data still has gaps

2. SMS NOTIFICATIONS DISABLED
   - Twilio integration built and tested
   - Blocked by A2P 10DLC registration requirements
   - Need to complete Twilio campaign registration
   - Status: WAITING on external process

3. PROFILE SECURITY
   - Currently wide open - anyone with phone number can access codes
   - No authentication beyond localStorage
   - Status: NEEDS WORK (see roadmap)

--------------------------------------------------------------------------------
DATABASE SCHEMA (Key Tables)
--------------------------------------------------------------------------------

PROFILES
- id, name, avatar, phone, code (unique 6-char)
- created_at

RIVALRIES
- id, profile_a_id, profile_b_id
- status: 'active' | 'complete' | 'cancelled' | 'summarizing'
- mic_holder_id, first_show_started
- intro_emcee_text, started_at, ended_at
- summary (JSONB), match_length (default 11)
- Constraint: unique_active_rivalry (one active per player pair)

SHOWS
- id, rivalry_id, show_number (1-11)
- prompt_id, prompt, judges (array of 3)
- profile_a_id, profile_a_answer, profile_a_submitted_at
- profile_b_id, profile_b_answer, profile_b_submitted_at
- winner_id, judge_data (JSONB), status
- first_submitter_id, last_nudge_at, emcee_text

JUDGES
- key, name, emoji, description, examples
- voice, scoring_bias, harshness, weight

EMCEE_LINES
- id, trigger_type, conditions (JSONB)
- template, weight, requires_history

--------------------------------------------------------------------------------
COST ANALYSIS
--------------------------------------------------------------------------------

Per 11-show rivalry:
- AI Judging: 11 shows Ã— $0.015 = ~$0.17
- AI Summary: 1 call Ã— $0.06 = ~$0.06
- Emcee Lines: 11 shows Ã— <$0.001 = ~$0.01
- Total per rivalry: ~$0.24

At scale:
- 1,000 rivalries/month: ~$240/month
- 10,000 rivalries/month: ~$2,400/month

--------------------------------------------------------------------------------
ROADMAP: WHAT'S NEXT
--------------------------------------------------------------------------------

PRIORITY: HIGH (Do Soon)
-------------------------

1. TWILIO SMS - ADD SUMMARY READY MESSAGE
   What: Send SMS when rivalry ends: "Your 11-show rivalry is complete! See who won the Golden Mic."
   Complexity: LOW - Just add new notification type
   Dependencies: Twilio A2P registration
   Notes: Already have verdict_ready and nudge types built

2. PROFILE SECURITY / AUTH
   What: Secure profile access - enter phone, get SMS link or verification code
   Options:
   - Magic Link: SMS sends link that auto-logs in
   - PIN Code: Set 4-digit PIN during profile creation
   - SMS Verification: Enter phone â†’ receive code â†’ verify
   Complexity: MEDIUM
   Notes: Critical before any real user growth. Current system is wide open.
   My Recommendation: Magic Link feels cleanest. User enters phone, gets SMS 
   with link, taps link, they're in. Works across devices naturally.

3. TEST EVERYTHING THOROUGHLY
   What: Full QA pass on all flows
   Test cases:
   - /join/CODE link flow
   - Single browser (not both open)
   - Return at random times mid-rivalry
   - Network interruption recovery
   - Edge cases (both submit simultaneously, etc.)
   Complexity: TIME - not code
   Notes: Should do before inviting real users

4. SHARE FUNCTIONALITY IMPROVEMENTS
   What: Make sharing more compelling
   Current: Just copies text to clipboard
   Options:
   - Screenshot/Image: Generate shareable image with score, names, key stats
   - Social Share: Direct share buttons (Twitter, iMessage, etc.)
   - Deep Link: Include link to start rivalry with winner
   My Recommendation: Image generation is highest impact. A visual summary 
   card that looks good on social. Use html2canvas or similar.
   Complexity: MEDIUM (image gen) to LOW (social buttons)

PRIORITY: MEDIUM (Build When Ready)
-----------------------------------

5. CENTRAL PROFILE SCREEN / RIVALRY DASHBOARD
   What: One screen to rule them all
   Features:
   - View all profiles on this device
   - Switch between profiles easily
   - See current rivalry status (whose turn, show #, W/L)
   - See past completed rivalries with results
   - Tap into any past rivalry to view shows
   - Edit/delete profiles
   Complexity: MEDIUM-HIGH
   Notes: This is the foundation for multiple rivalries per person.
   Natural evolution of current "challenge" screen.

6. MULTIPLE RIVALRIES PER PERSON
   What: Same person can have rivalries with multiple friends
   Current workaround: Create multiple profiles (works but clunky)
   Real solution: One phone â†’ One account â†’ Multiple active rivalries
   UI: Rivalry Dashboard with tiles showing each rivalry status
   Complexity: MEDIUM
   Notes: This unlocks power users. Worth the effort.

7. QUICK REMATCH BUTTON
   What: Easy way to start new rivalry with same opponent
   Where: Summary screen, after "Start a New Rivalry"
   Challenge: Constraint prevents two active rivalries between same pair
   Solution: Button only appears when current rivalry is complete
   Complexity: LOW (we had it, removed for simplicity - can add back)

8. IN-GAME RIBBING BETWEEN RIVALS
   What: Let players send quick messages/reactions to opponent
   Ideas:
   - Pre-set reactions: "ðŸ”¥ That was good" / "ðŸ˜¬ Really?" / "ðŸ’€ RIP"
   - After seeing verdict, send taunt to opponent
   - Show in-game chat/reaction feed
   Complexity: MEDIUM
   Notes: Adds social layer. Could be simple reactions or full chat.
   Start with canned reactions - lower risk of abuse.

9. RIVALRY NAMING
   What: Let players name their rivalries
   Examples: "Beach House Showdown", "Office Wars", "Bros Battle"
   Where: When creating rivalry or editable any time
   Display: Show name in rivalry list, summary screen
   Complexity: LOW
   Notes: Adds personalization, makes rivalries feel special

PRIORITY: LOWER (Nice to Have)
------------------------------

10. TALE OF THE TAPE SUMMARY
    What: Sports-stats style summary instead of paragraphs
    Format:
    âš¡ TALE OF THE TAPE âš¡
    ðŸŽ¨ Most Creative:     Craig Left (Show 7 - "buy out OnlyFans")
    ðŸ¤ª Most Absurd:       Craig Right (Show 1 - "20 gallon olive jar")
    ðŸ˜¤ Closest Battle:    Show 5 (won by 1 point)
    ðŸ”¥ Biggest Blowout:   Show 9 (Craig Left +12)
    ðŸŽ¯ Judge's Nightmare: Show 3 (all judges disagreed)
    ðŸ† Clutch Performer:  Craig Right (3 comeback wins)
    Benefits: Scannable, shareable, fun superlatives
    Complexity: MEDIUM (need to calculate stats from show data)
    Notes: Could replace or supplement current narrative analysis

11. ADD MORE JUDGES (25 more)
    What: Double the judge roster, include celebrity-inspired personalities
    Ideas:
    - Gordon Ramsay type (brutal but fair)
    - Oprah type (encouraging, deep questions)
    - Simon Cowell type (harsh but honest)
    - Sports commentator types
    - Regional/cultural judges
    Complexity: LOW (just database inserts + prompt tuning)
    Notes: More variety = more replayability

12. NEW RESPONSE TYPES
    What: Beyond text answers
    Options:
    - Photo/Image responses
    - Drawing (simple canvas)
    - Audio/Voice recording
    - GIFs
    Complexity: HIGH (need new UI, storage, AI vision/audio)
    Notes: Big lift. Text works well. Revisit when core is solid.

13. BRAIN BOOST "LEARN MORE"
    What: Expand Brain Boost into mini-learning moments
    Ideas:
    - Link to creativity tips
    - Science of quick thinking
    - Exercises to improve
    Complexity: LOW-MEDIUM
    Notes: Nice educational angle, not core to fun

14. 1-PLAYER MODE
    What: Play against AI opponent
    Reality: One-Upper's magic IS the rivalry with a friend
    If built: AI opponent that actually competes (not just judges)
    My Recommendation: WAIT. Focus on multiplayer. The social competition 
    is your core value prop. Solo mode dilutes that.
    Priority: LOW

15. SECURE SUPABASE MORE
    What: Row-level security, API key management, etc.
    Actions:
    - Enable RLS on all tables
    - Audit who can read/write what
    - Move any client-side secrets server-side
    Complexity: MEDIUM
    Notes: Do before scaling. Current setup is fine for beta.

16. STREAMLINE CODE
    What: Clean up, optimize, reduce duplication
    Actions:
    - Audit component sizes (Screen4 is 1600+ lines)
    - Extract reusable components
    - Optimize re-renders
    - Remove dead code
    Complexity: MEDIUM
    Notes: Technical debt. Address periodically.

17. STREAMLINE VERDICT SCREEN CONTENT
    What: Too much text on verdict screen?
    Current: Scores + banter + rivalry comment + artifacts + brain boost
    Options:
    - Collapse some sections by default
    - Move artifacts to "See Details" expansion
    - Save some content for past show view only
    Complexity: LOW
    Notes: Test with real users first. They might love the detail.

--------------------------------------------------------------------------------
OTHER IDEAS DISCUSSED
--------------------------------------------------------------------------------

- Seasonal themes/tournaments
- Leaderboards (global, friends)
- Tournament brackets
- Sponsors/monetization
- Content marketing with best-of compilations
- Season structure (20-show "seasons" with AI recap)
- Achievement badges
- Streak rewards
- Push notifications (beyond SMS)
- Web push notifications
- Desktop app
- Native mobile apps (React Native?)

--------------------------------------------------------------------------------
FILES REFERENCE
--------------------------------------------------------------------------------

Key React Components:
- src/App.jsx - Main router
- src/components/Screen1.jsx - Profile/rivalry start
- src/components/Screen2.jsx - Profile management
- src/components/Screen4.jsx - Main gameplay (1680+ lines)
- src/components/Screen6.jsx - Show history detail
- src/components/Screen6Summary.jsx - Show detail from summary
- src/components/RivalrySummaryScreen.jsx - End of rivalry summary
- src/components/LandingPage.jsx - Marketing/onboarding
- src/components/HowToPlayModal.jsx - How to play
- src/components/InterstitialScreen.jsx - Ripley emcee
- src/components/Header.jsx - App header
- src/components/JudgesPage.jsx - Judge gallery
- src/config.js - RIVALRY_LENGTH = 11

Edge Functions:
- supabase/functions/judge-show/index.ts - AI judging
- supabase/functions/select-emcee-line/index.ts - Ripley lines
- supabase/functions/summarize-rivalry/index.ts - AI summary
- supabase/functions/send-sms/index.ts - Twilio SMS

--------------------------------------------------------------------------------
SESSION SUMMARY (Nov 24, 2025)
--------------------------------------------------------------------------------

What We Built Today:
1. Complete 11-show rivalry system (was infinite)
2. Special Ripley emcee lines for shows 9, 10, 11
3. AI-generated rivalry summary with analysis, styles, moments
4. Summary screen with golden mic, past shows viewer
5. Race condition prevention for summary generation
6. Screen6Summary for dedicated past show viewing
7. Fixed judge score parsing (NaN bug)
8. Updated landing page and how-to-play for 11-show format
9. Reset judgeView on show change
10. Various UX improvements (button text, no auto-advance after 11)

Key Decisions Made:
- 11 shows (not 21) - faster iteration, can adjust later
- No rematch button for now - simplicity over features
- Dedicated Screen6Summary vs flag-based routing
- Winner-only golden mic display
- No bullets in memorable moments

What's Tested:
- Full 11-show rivalry flow
- Summary generation with real data
- Score accuracy verified
- Both player perspectives
- Past show navigation

What's Left:
- Real user testing
- Twilio activation
- Profile security
- Multiple rivalries per person
- Sharing improvements

================================================================================
END OF SUMMARY
================================================================================
