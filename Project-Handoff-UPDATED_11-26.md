# One-Upper: Complete Project Handoff Document
**Last Updated:** November 26, 2025 (Evening Session)  
**Status:** Live in Production at https://oneupper.app

---

## Table of Contents
1. [Project Overview](#project-overview)
2. [Tech Stack & Environment](#tech-stack--environment)
3. [Game Concept & Gameplay](#game-concept--gameplay)
4. [Complete Feature Set](#complete-feature-set)
5. [Screen-by-Screen Reference](#screen-by-screen-reference)
6. [Database Schema](#database-schema)
7. [File Structure Reference](#file-structure-reference)
8. [Recent Session Work (November 26, 2025)](#recent-session-work-november-26-2025)
9. [SMS & Twilio Status](#sms--twilio-status)
10. [Known Issues & Technical Debt](#known-issues--technical-debt)
11. [Next Priorities](#next-priorities)
12. [Development Workflow](#development-workflow)

---

## Project Overview

One-Upper is a **1v1 async competitive mobile-first web game** where two players compete by answering creative prompts, with AI judge personalities determining winners. The game transforms the socially problematic behavior of "one-upping" into structured competitive entertainment.

### Core Innovation
- **No traditional accounts** - Players create profiles with unique codes (ADJECTIVE-NOUN-####)
- **Real-time multiplayer synchronization** via Supabase subscriptions
- **AI judging** with 25+ distinct personality biases (Claude Sonnet 4)
- **Mobile-first PWA-ready** dark gradient design
- **Deep link sharing** via SMS/text for frictionless invites
- **Rivalry Stakes** - Optional custom wagers beyond the Golden Mic

### Target User
Friends who want competitive social entertainment without friction. Emphasizes "challenge a friend" simplicity while maintaining engaging gameplay that works whether players are together or apart.

### Taglines
- **Primary:** "Part brain boost, all buddy boast."
- **Secondary:** "Answer the same prompt. AI judges crown a winner. Repeat."

---

## Tech Stack & Environment

### Frontend
- **Framework:** React 18 with Vite
- **Styling:** Tailwind CSS (utility-first, mobile-first)
- **Routing:** React Router v6
- **State Management:** React hooks (useState, useEffect, useRef)
- **Special Libraries:** 
  - `canvas-confetti` for celebration effects
  - Custom SVG assets (`microphone.svg` for golden mic icon)

### Backend
- **Database:** Supabase (PostgreSQL)
- **Real-time:** Supabase real-time subscriptions
- **Edge Functions:** Supabase Edge Functions (Deno runtime)
- **Authentication:** Currently localStorage + profile codes (planning Twilio SMS OTP)

### Deployment & DNS
- **Hosting:** Vercel (auto-deploys from GitHub main branch)
- **Domain:** oneupper.app (managed via DirectNIC ‚Üí Cloudflare)
- **DNS:** Cloudflare
- **Email Routing:** Cloudflare Email Routing
  - `hello@oneupper.app` ‚Üí forwards to personal email
  - `support@oneupper.app` ‚Üí forwards to personal email
- **SSL:** Automatic via Vercel + Cloudflare

### AI & APIs
- **Judging Model:** Claude Sonnet 4 via Anthropic API
- **Cost:** ~$0.01-0.02 per judgment
- **Implementation:** Called from Supabase Edge Function `judge-show`
- **Rivalry Summaries:** Supabase Edge Function `summarize-rivalry`

---

## Game Concept & Gameplay

### The Rivalry Structure
- Every rivalry consists of exactly **11 shows** (configurable via `RIVALRY_LENGTH`)
- Two players compete head-to-head
- Winner of each show claims the **Golden Mic** üé§
- Player with most wins after 11 shows wins the rivalry
- Optional **stakes** can be set by the challenger (lunch, $20, loser mows lawn, etc.)

### Show Flow
1. **Prompt Revealed** - Both players see the same creative prompt
2. **Answer Submission** - Each player submits their response (async - can be minutes or days apart)
3. **AI Judging** - 3 randomly selected judges score both answers (0-10 each)
4. **Verdict** - Winner announced with judge commentary and optional "judge chat" banter
5. **Mic Transfer** - Winner holds mic, loser gets it for next show (visual indicator)
6. **Repeat** - Continue until 11 shows complete

### Judge System
- **25+ unique AI personalities** with distinct scoring biases
- Each show randomly selects 3 judges
- Judges provide:
  - Individual scores (0-10 per player)
  - Commentary on each answer
  - Optional "judge chat" (banter between judges)
- Examples: Savage Sarah (brutal), Coach Kevin (encouraging), Snoot Wellington III (sophisticated)

### Rivalry Summary
- Generated by AI after all 11 shows complete
- Includes:
  - Final score and winner declaration
  - Stakes reminder (who owes what)
  - Rivalry analysis narrative
  - Player style profiles
  - Memorable moments
  - Full show history access

---

## Complete Feature Set

### ‚úÖ Profile System
- **Code Format:** ADJECTIVE-NOUN-#### (e.g., HAPPY-TIGER-1234)
- **Storage:** localStorage for device persistence
- **Recovery:** Phone number lookup via "Forgot Code" modal
- **Avatars:** 8 emoji options (üòéü§ìüòàü§°üéÉü¶Ñüêâü§ñ)
- **Fields:** Name, Avatar, Phone (US format), Bio (optional), SMS Consent
- **Multi-Profile Support:** Multiple profiles per phone number
- **Profile Hub:** View all profiles, switch between them, see rivalry history per profile
- **Management:** Create, edit, delete profiles
- **Security Note:** Currently anyone with phone number can retrieve codes (needs SMS OTP auth)

### ‚úÖ Rivalry System
- **Format:** 1v1 only, exactly 11 shows
- **Creation Methods:**
  1. Share your code (copy or SMS)
  2. Enter friend's code manually
  3. Deep link via `/join/CODE`
- **Stakes Feature (NEW):** 
  - Challenger can optionally set stakes when sharing code
  - üé≤ button for random suggestions (29 options)
  - Stakes displayed on join, rivalry start, and summary screens
  - Included in share text after rivalry completes
- **Mic Holder:** Visual indicator of current leader
- **Status Tracking:** Active rivalries prevent new rivalries
- **Cancellation:** Either player can cancel, history preserved
- **Real-time Sync:** Opponent actions update your screen live

### ‚úÖ Gameplay Loop
- **Prompt Selection:** Random from curated database
- **Answer Input:** Text area with character awareness
- **Judging:** 3 random judges, ~$0.01-0.02 cost per judgment
- **Verdict Display:** 
  - Segmented toggle: Judge Scores / Judge Chat
  - Individual judge cards with scores and commentary
  - Winner celebration with confetti
- **Auto-advance:** 30-second countdown after verdict, can cancel
- **Ripley (Game Host):** AI emcee provides commentary at key moments

### ‚úÖ History & Profiles
- **Profile Hub (Screen2):**
  - Lists all profiles for phone number
  - Win/loss record per profile
  - Access to rivalry history per profile
- **Past Rivalries List:**
  - Shows opponent, final score, date
  - Win/Loss indicator
  - Tap to view full rivalry summary
- **Past Shows:**
  - Full history within rivalry
  - Tap any show to see detailed verdict
  - Unlimited scroll (no pagination limit)

### ‚úÖ UI/UX Polish
- **Golden Mic Icon:** Custom SVG throughout (landing, scoreboard, verdicts, history)
- **Dark Theme:** Slate gradient background (#1e293b to #0f172a), orange accents (#f97316)
- **Mobile-First:** Touch-friendly, responsive design
- **Scroll Restoration:** Manual scroll management for proper back navigation
- **Loading States:** Skeleton/pulse animations during data fetches
- **Error Handling:** User-friendly error messages with retry options

### ‚úÖ Pages & Routes
| Route | Component | Purpose |
|-------|-----------|---------|
| `/` | LandingPage | Marketing, game explanation |
| `/play` | Screen1 | Profile creation, rivalry management |
| `/join/:code` | JoinRivalry | Deep link handler for invites |
| `/judges` | JudgesPage | Gallery of all AI judges |
| `/privacy` | PrivacyPage | Privacy policy |
| `/terms` | TermsPage | Terms of service |

### ‚úÖ Legal & Compliance
- **Privacy Policy:** Comprehensive, includes SMS/mobile number protection language
- **Terms of Service:** Standard game ToS with content licensing
- **SMS Consent:** Explicit opt-in checkbox during profile creation
- **TCPA Compliance:** Proper disclosures for SMS notifications
- **Copyright:** "¬© 2025 One-Upper‚Ñ¢. All rights reserved."

---

## Screen-by-Screen Reference

### Landing Page (`/`)
- Hero with logo and tagline
- "Play Now" CTA
- How It Works (3 steps)
- The Judges (3 sample judges + link to full gallery)
- What You're Playing For (Golden Mic + stakes mention)
- Why Play (4 benefits)
- Ready to Play CTA
- Footer with contact, legal links

### Screen1 (`/play`) - Three States

**State A: Create Profile**
- New user profile creation form
- Resume with existing code
- "Forgot Code" phone lookup modal
- Shows pending invite if arriving from `/join` link

**State B: Challenge a Friend**
- Your profile card with code
- "Challenge a Friend" section:
  - Stakes input with üé≤ random suggestion button
  - Copy Code button
  - Share via SMS button
- "Enter Code" button to join someone else's rivalry
- Join Modal with code input (shows challenger's stakes if set)
- Menu: How to Play, Your Profiles, Log Out

**State C: Rivalry Started**
- "üéâ Rivalry Started!" celebration
- Stakes display (if set)
- Ripley's intro commentary
- "Start First Show" button
- Menu: How to Play, Your Profiles, Log Out, Cancel Rivalry

### Screen2 - Profile Hub
- Back to Profiles navigation
- Profile header (avatar, name)
- "Rivalry History" label
- List of past rivalries with:
  - Opponent name/avatar
  - Win/Loss and score
  - Date
- Tap to view rivalry summary

### Screen4 - Active Gameplay
- Scoreboard header (both players, scores, mic indicator)
- Current show prompt
- Answer submission area OR waiting for opponent
- Verdict display with judge toggle
- Past shows list (collapsible)
- Auto-advance countdown
- Menu options

### Screen6 - Past Show Detail
- Full verdict from a completed show
- Judge scores and commentary
- Both players' answers
- Navigation back to game

### RivalrySummaryScreen - Rivalry Complete
- Golden Mic display (winner only)
- Final score (e.g., 7-4)
- Stakes outcome (winner gets X / loser owes X)
- AI-generated rivalry analysis
- Player style profiles
- Memorable moments
- Past shows history (collapsible)
- "Start a New Rivalry" CTA
- Share Summary button

### JudgesPage (`/judges`)
- Responsive grid of all 25+ judges
- Random order on each load
- Tap judge for detail modal
- Back navigation

---

## Database Schema

### profiles
```sql
- id (uuid, primary key)
- name (text, not null)
- avatar (text) - emoji character
- phone (text) - 10 digits, US only
- bio (text, nullable)
- code (text, unique) - ADJECTIVE-NOUN-####
- sms_consent (boolean, default false)
- pending_stakes (text, nullable) - stakes awaiting rivalry creation
- created_at (timestamptz)
```

### rivalries
```sql
- id (uuid, primary key)
- profile_a_id (uuid, foreign key)
- profile_b_id (uuid, foreign key)
- status (text) - 'active', 'complete', 'cancelled'
- mic_holder_id (uuid, foreign key)
- first_show_started (boolean)
- stakes (text, nullable) - what players are competing for
- intro_emcee_text (text, nullable) - Ripley's intro
- summary (jsonb, nullable) - AI-generated rivalry summary
- created_at (timestamptz)
- ended_at (timestamptz, nullable)
```

### shows
```sql
- id (uuid, primary key)
- rivalry_id (uuid, foreign key)
- show_number (integer)
- prompt_id (uuid, foreign key)
- prompt (text)
- judges (text[]) - array of judge keys
- profile_a_id (uuid)
- profile_b_id (uuid)
- profile_a_answer (text, nullable)
- profile_b_answer (text, nullable)
- judge_data (jsonb) - scores, comments, banter
- winner_id (uuid, nullable)
- status (text) - 'waiting', 'judging', 'complete'
- created_at (timestamptz)
```

### judges
```sql
- id (integer, primary key)
- key (text, unique) - e.g., 'savage'
- name (text) - e.g., 'Savage Sarah'
- emoji (text) - e.g., 'üòà'
- description (text) - judging style
- examples (text) - sample one-liners
```

### prompts
```sql
- id (uuid, primary key)
- text (text) - the prompt text
- category (text, nullable)
- created_at (timestamptz)
```

---

## File Structure Reference

### Frontend Components
```
src/
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ LandingPage.jsx        - Marketing/home page
‚îÇ   ‚îú‚îÄ‚îÄ Screen1.jsx            - Profile mgmt, rivalry creation (1500+ lines)
‚îÇ   ‚îú‚îÄ‚îÄ Screen2.jsx            - Profile Hub, rivalry history
‚îÇ   ‚îú‚îÄ‚îÄ Screen4.jsx            - Active gameplay
‚îÇ   ‚îú‚îÄ‚îÄ Screen6.jsx            - Past show detail
‚îÇ   ‚îú‚îÄ‚îÄ Screen6Summary.jsx     - (if separate from Screen6)
‚îÇ   ‚îú‚îÄ‚îÄ RivalrySummaryScreen.jsx - End of rivalry summary
‚îÇ   ‚îú‚îÄ‚îÄ JoinRivalry.jsx        - Deep link handler (/join/:code)
‚îÇ   ‚îú‚îÄ‚îÄ JudgesPage.jsx         - Meet the judges gallery
‚îÇ   ‚îú‚îÄ‚îÄ PastRivalriesList.jsx  - List of completed rivalries
‚îÇ   ‚îú‚îÄ‚îÄ HowToPlayModal.jsx     - Game instructions modal
‚îÇ   ‚îú‚îÄ‚îÄ PrivacyPage.jsx        - Privacy policy
‚îÇ   ‚îú‚îÄ‚îÄ TermsPage.jsx          - Terms of service
‚îÇ   ‚îî‚îÄ‚îÄ Header.jsx             - Reusable header with logo
‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îî‚îÄ‚îÄ supabase.js            - Supabase client config
‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îú‚îÄ‚îÄ prompts.js             - Prompt selection, judge selection
‚îÇ   ‚îú‚îÄ‚îÄ phoneUtils.js          - Phone number formatting/validation
‚îÇ   ‚îî‚îÄ‚îÄ codeGenerator.js       - Profile code generation (ADJECTIVE-NOUN-####)
‚îú‚îÄ‚îÄ assets/
‚îÇ   ‚îî‚îÄ‚îÄ microphone.svg         - Golden mic icon
‚îú‚îÄ‚îÄ config.js                  - RIVALRY_LENGTH and other constants
‚îî‚îÄ‚îÄ App.jsx                    - Router configuration
```

### Supabase Edge Functions
```
supabase/functions/
‚îú‚îÄ‚îÄ judge-show/
‚îÇ   ‚îî‚îÄ‚îÄ index.ts               - AI judging via Claude API
‚îú‚îÄ‚îÄ summarize-rivalry/
‚îÇ   ‚îî‚îÄ‚îÄ index.ts               - AI rivalry summary generation
‚îú‚îÄ‚îÄ select-emcee-line/
‚îÇ   ‚îî‚îÄ‚îÄ index.ts               - Ripley commentary generation
‚îî‚îÄ‚îÄ send-sms/
    ‚îî‚îÄ‚îÄ index.ts               - SMS notifications via Twilio (pending)
```

### Public Assets
```
public/
‚îú‚îÄ‚îÄ logo.png                   - One-Upper logo
‚îú‚îÄ‚îÄ favicon.ico
‚îî‚îÄ‚îÄ manifest.json              - PWA manifest (if configured)
```

---

## Recent Session Work (November 26, 2025)

### Rivalry Stakes Feature (Complete - All 5 Phases)

**Phase 1: Database + Input**
- Added `stakes` column to rivalries table
- Added `pending_stakes` column to profiles table
- Stakes input field on Challenge screen with placeholder text
- üé≤ dice button with 29 random stake suggestions
- Stakes saved to profile's `pending_stakes` when sharing code

**Phase 2: Display During Join/Start**
- Stakes shown in Join Modal after valid code entered
- Stakes shown on pending invite display (State A & B)
- Stakes transferred from `pending_stakes` ‚Üí `rivalries.stakes` on creation
- Stakes cleared from profile after rivalry created
- Stakes shown on Rivalry Started screen (State C)

**Phase 3: Rivalry Summary**
- Winner sees: "+ [stakes] from [opponent] üéØ"
- Loser sees: "You owe [opponent]: [stakes] üéØ"
- Share text includes stakes outcome

**Phase 4: History (Skipped)**
- Past Rivalries List already clean, stakes visible in Summary

**Phase 5: Landing Page**
- Added stakes messaging to "What You're Playing For" section

### Stakes Suggestions (29 options)
```javascript
"bragging rights", "a coffee", "lunch", "dinner", "a beer", "a 6 pack",
"$5", "$10", "$20", "who posts embarrassing photo", "who picks the movie",
"eternal glory", "a slice of pizza", "ice cream cone", "donuts for the office",
"winner's favorite takeout", "a home-cooked meal", "who mows the other's lawn",
"who cleans the car", "who buys the next 5 rounds", "who has to change their profile pic",
"who picks karaoke song", "who wears a silly hat", "who admits they were wrong",
"public praise on social media", "who picks the restaurant", "who picks the playlist",
"who picks the next binge show", "naming rights for something"
```

### Other Session Fixes
- **Scroll-to-top fix:** Added `useLayoutEffect` with `scrollRestoration = 'manual'` to LandingPage, TermsPage, PrivacyPage for proper back navigation
- **Terms/Privacy links:** Changed from broken modals to simple links with `navigate(-1)` back button
- **Landing page spacing:** Tightened Golden Mic section bottom padding

---

## SMS & Twilio Status

### Current Status
- ‚è≥ **A2P 10DLC Campaign:** Resubmitted with comprehensive compliance rewrite
- Previous rejection reason: Error 30909 (incomplete Call to Action)
- Kill switch ready: `SMS_ENABLED = false`

### Compliance Updates Made
1. **Campaign Description:** Detailed game explanation with opt-in URL
2. **Sample Messages:** All include brand name + opt-out instruction
3. **Opt-in Confirmation Message:** Welcome SMS with frequency disclosure
4. **Consent Flow Description:** Detailed checkbox + disclosures explanation
5. **Privacy Policy:** Added explicit mobile number protection language
6. **Terms/Privacy Links:** Now visible on opt-in screen

### Planned SMS Notifications
| Type | Trigger | Message |
|------|---------|---------|
| Welcome | Profile created with SMS consent | Confirmation + opt-out info |
| Your Turn | Opponent submitted answer | Link to play |
| Verdict Ready | Judging complete | Link to see results |
| Nudge | Manual "nudge" button | Reminder to play |
| Rivalry Complete | All 11 shows done | Summary available |

---

## Known Issues & Technical Debt

### Security (Critical)
- **Phone lookup vulnerability:** Anyone with phone number can retrieve profile codes
- **Solution:** Implement Supabase Auth OTP via Twilio once approved

### UX Improvements Needed
- **Offline handling:** No graceful degradation when offline
- **PWA refresh:** No pull-to-refresh in PWA mode
- **Share functionality:** Currently just clipboard copy, needs refinement

### Technical Debt
- Screen1.jsx is 1500+ lines - could be split into smaller components
- Some emoji rendering issues on certain devices (shows as rectangles)
- No automated tests

---

## Next Priorities

### üî¥ IMMEDIATE (This Week)

**1. Comprehensive Testing**
- Test all rivalry flows end-to-end
- Test stakes feature all scenarios
- Test deep links from various entry points
- Test on multiple devices/browsers
- Test PWA mode specifically

**2. Share Functionality Refinement**
- Current: Clipboard copy of text
- Options to explore:
  - Native share sheet (Web Share API)
  - Generate shareable image/card
  - Direct SMS integration
- Consider different share contexts (invite vs. result)

**3. Offline Handling**
- Detect offline state
- Show user-friendly message
- Queue actions for when back online (or not)
- Prevent confusing error states

**4. PWA Refresh Support**
- Add pull-to-refresh gesture
- Or add visible refresh button in header/menu
- Handle stale data gracefully

### üü° SHORT-TERM (Next 2 Weeks)

**5. Twilio Approval ‚Üí SMS Wiring**
Once approved:
- Welcome SMS on profile creation
- "Your turn" notifications
- Verdict ready notifications
- Rivalry complete notifications
- Nudge functionality
- Magic link authentication

**6. Profile Security Upgrade**
- Implement Supabase Auth OTP
- Phone verification before showing codes
- Proper session management

**7. Error Handling Improvements**
- Better error messages throughout
- Retry mechanisms for failed API calls
- Fallback states for edge cases

### üü¢ MEDIUM-TERM (Month+)

**8. Engagement Features**
- Win streaks tracking
- Rivalry rematch functionality
- Quick reactions/emoji responses

**9. Content Expansion**
- More prompts
- More judges (25 ‚Üí 50)
- Seasonal/themed content

**10. Social Features**
- Share verdict images
- Highlight reel generation
- Public profiles (opt-in)

### ‚ùå NOT NOW

- Leaderboards (needs moderation strategy)
- 1-player mode (undermines core value prop)
- Real-time chat (too much moderation burden)
- Multiple concurrent rivalries (adds complexity)

---

## Development Workflow

### Local Development
```bash
cd /path/to/one-upper
npm install
npm run dev
# Access at http://localhost:5173
```

### Deploy to Production
```bash
git add .
git commit -m "Description of changes"
git push origin main
# Vercel auto-deploys from main branch
```

### Supabase Edge Functions
```bash
# Deploy a function
supabase functions deploy function-name

# View logs
supabase functions logs function-name --tail

# Test locally
supabase functions serve function-name
```

### Database Changes
```bash
# Run migrations
supabase db push

# Or execute SQL directly in Supabase Dashboard ‚Üí SQL Editor
```

### Testing Checklist
- [ ] Create new profile
- [ ] Resume with existing code
- [ ] Forgot code recovery
- [ ] Start rivalry with stakes
- [ ] Start rivalry without stakes
- [ ] Join via deep link
- [ ] Join via manual code entry
- [ ] Complete full 11-show rivalry
- [ ] View rivalry summary
- [ ] Share summary
- [ ] View past rivalries
- [ ] Switch between profiles
- [ ] Cancel rivalry mid-game
- [ ] Test on iOS Safari
- [ ] Test on Android Chrome
- [ ] Test in PWA mode

---

## Contact & Resources

**Live Site:** https://oneupper.app  
**Domain Registrar:** DirectNIC  
**DNS:** Cloudflare  
**Hosting:** Vercel  
**Database:** Supabase  
**Email:** Cloudflare Email Routing  
**SMS:** Twilio (pending A2P approval)  
**AI Model:** Claude Sonnet 4 (Anthropic API)

**Contact Emails:**
- General: hello@oneupper.app
- Support: support@oneupper.app

---

## Session Summary (November 26, 2025)

### Completed ‚úÖ
1. Rivalry Stakes feature (all 5 phases)
   - Database migration
   - Input field with üé≤ random suggestions
   - Display throughout join/start flows
   - Summary winner/loser messaging
   - Share text includes stakes
   - Landing page update
2. Fixed scroll-to-top on back navigation (LandingPage, Terms, Privacy)
3. Fixed Terms/Privacy modal issues (now simple page links with back)
4. Tightened Landing page Golden Mic section spacing

### Files Modified
- `Screen1.jsx` - Stakes input, join modal updates, state management
- `JoinRivalry.jsx` - Pass stakes through session storage
- `RivalrySummaryScreen.jsx` - Stakes display and share text
- `LandingPage.jsx` - Stakes messaging, scroll fix, spacing
- `TermsPage.jsx` - Scroll fix, back navigation
- `PrivacyPage.jsx` - Scroll fix, back navigation, mobile number protection text

### Key Decisions
- Stakes are optional, zero friction
- Challenger sets stakes, joiner sees but can't negotiate
- Stakes persist on rivalry record forever (for history)
- Keep Past Rivalries list clean, stakes visible in Summary only

---

**End of Handoff Document**  
**Version:** 5.0  
**Date:** November 26, 2025 (Evening)
