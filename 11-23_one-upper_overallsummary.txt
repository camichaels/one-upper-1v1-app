One-Upper - Complete Project Documentation
Updated: November 23, 2024

Executive Summary
One-Upper is a fully functional 1v1 async mobile game where players engage in escalating creative duels judged by AI personalities. The core concept transforms the socially problematic behavior of "one-upping" into structured competitive entertainment with real-time multiplayer synchronization, comprehensive AI judging, and rich personality features.
Current Status: Production-ready, deployed at oneupper.app, awaiting Twilio A2P 10DLC registration before scaling beyond close friends.

Product Overview
Core Concept
Players submit creative responses to prompts (e.g., "What would you do with $1M but only 24 hours?") and compete to "one-up" their opponent. Three AI judge personalities with distinct biases score each answer (1-10), and the highest total score wins the show. The rivalry continues indefinitely with a running score, creating an ongoing competitive narrative.
Key Innovation

Async-first gameplay: Works across time zones, no simultaneous play required
AI personality showcase: 25 distinct judges with varied scoring criteria and commentary styles
Narrative layer: Ripley (emcee) provides meta-commentary, artifacts add shareable moments
Mobile-optimized: Clean UI, fast gameplay loop, accessible anywhere

Target Audience
Friends who want engaging competitive experiences that work across devices and time zones. Emphasizes accessibility through unique profile codes rather than traditional authentication.

Technical Architecture
Stack

Frontend: React 18 + Vite, Tailwind CSS
Backend: Supabase (PostgreSQL + Edge Functions + Real-time)
AI: Claude Sonnet 4 via Anthropic API (through Edge Functions)
Deployment: Vercel with custom domain (oneupper.app)
Notifications: Twilio SMS (built, awaiting A2P 10DLC registration)

Infrastructure Decisions

No traditional auth: Profile codes (ADJECTIVE-NOUN-####) for simplicity
Real-time subscriptions: WebSocket-based sync for multiplayer
Edge Functions: Supabase-hosted for AI calls (judging, emcee lines, artifacts)
JSONB storage: Flexible judge_data structure for complex AI outputs
Cost-conscious AI: ~$0.01-0.02 per show judgment


Complete Feature Set
1. Core Gameplay Loop ‚úÖ
Profile Management

Create profiles with unique codes (e.g., HAPPY-TIGER-1234)
Multiple profiles per phone number (switch between rivalries)
Edit name, avatar (emoji), phone, bio
Cross-device access via "Resume with Code"
localStorage persistence + Supabase sync

Rivalry System

1v1 format, one active rivalry at a time per profile
Start rivalry by sharing/entering opponent's code
Either player can start first show
Cancel rivalry with confirmation (both players notified)
Mic holder indicator (current winner)

Show Flow

Random prompt from 100+ curated prompts
3 randomly selected judges from 25 personalities
30-word answer limit (enforced, live word count)
Real-time opponent submission detection
Auto-advance to judging when both submit

AI Judging (Claude Sonnet 4)

Each judge scores independently (1-10)
Judge one-liners (under 12 words, in character)
Judge banter (3-4 lines, conversational)
Winner determined by total score across judges
Detailed score breakdown (both players visible)
~3 second judging time, ~$0.01-0.02 cost per show

Verdict Display

Winner announcement with randomized declarations
Both answers shown side-by-side
Golden mic indicator for winner
Judge scores (segmented view: scores vs. chat)
Average score per player displayed
10-second auto-advance countdown (can override with "Stay Here")

Show History

Unlimited scrolling history (all past shows)
Click any show to view full verdict
Winner indicated with golden mic
Read-only detail view (Screen6)

2. Personality Layer ‚úÖ
Ripley (Emcee/Host)

300 pre-written lines stored in database
Appears on rivalry start (welcome text)
Show transition interstitials (Shows 2+)
Context-aware line selection based on:

Game conditions (tied, close, blowout, streak, comeback, milestone)
Score differentials
Show numbers (milestones at 5, 10, 20)


Database-driven with weighted randomization
Edge Function: select-emcee-line

Judge Rivalry Commentary

One judge per show provides 2-3 sentence meta-analysis
Comments on playing styles, rivalry dynamics, patterns
Appears in verdict screen (separate from scores/banter)
Generated during judging call (no extra cost)

Artifacts (Post-Show Fun)

Generated with every judgment (3 per show):

‚≠ê Celebrity Match: "Player's answer sounds like Ryan Reynolds"
üì∞ Fake Headline: Absurdist news about the answer
‚úÖ Fact Check: Playful roast with fake statistics


AI picks funniest player/answer for each type
All 3 displayed on verdict screen (for now)
Stored in judge_data JSONB (no separate DB fields)
Future: Randomize display (80% show 1 artifact, 20% show rivalry recap)

Brain Boost Affirmations

Verdict screen only: "üí° You Boosted Your Brain"
50 embedded affirmations celebrating creative thinking
Randomly selected when verdict loads, stays stable during countdown
No Supabase calls, zero performance hit
Reinforces meta-benefit (creative exercise while having fun)

3. User Experience Polish ‚úÖ
Visual Design

Mobile-first with clean hierarchy
Dark gradient theme (slate-900 ‚Üí slate-800)
Orange accents (orange-500) for CTAs
System fonts, universal compatibility
Minimal motion, subtle transitions
Confetti celebrations on win (intensity based on streak)
Streak indicators (fire emojis at 3, 5, 10 wins)

Real-Time Sync

WebSocket subscriptions for show updates
Race condition handling (both players advance simultaneously)
409 conflict resolution (one player creates show, other fetches)
Instant rivalry cancellation propagation
No polling, all event-driven

Mobile Optimizations

64px bottom padding (thumb-friendly on mobile)
Responsive text sizes
Touch-optimized buttons
Fast load times (minimal bundle size)

Navigation & State Management

Header component (persistent across screens)
Menu dropdown (switch profile, edit profile, cancel rivalry)
Judge profile modals (clickable judge buttons)
How to Play modal
Cancel rivalry confirmation modal
Smooth transitions between states

4. Database Schema ‚úÖ
Profiles
sqlid, code, name, avatar, phone, bio, created_at
Rivalries
sqlid, profile_a_id, profile_b_id, mic_holder_id, 
first_show_started, status, cancelled_by_id, 
intro_emcee_text, current_season, created_at
Unique constraint on (profile_a_id, profile_b_id) only when status='active'
Shows
sqlid, rivalry_id, show_number, prompt, judges[],
profile_a_id, profile_b_id, 
profile_a_answer, profile_b_answer,
profile_a_submitted_at, profile_b_submitted_at,
first_submitter_id, last_nudge_sent_at,
status, winner_id, judge_data, judged_at,
emcee_text, created_at
Prompts (100+ curated)
sqlid, text, category, is_active, created_at
Judges (25 personalities)
sqlid, key, name, emoji, description, examples, 
is_active, created_at
Emcee Lines (300 lines)
sqlid, trigger_type, condition, text, weight, created_at
```
*trigger_type: 'rivalry_intro', 'show_transition', 'milestone'*
*condition: 'any', 'tied_game', 'close_game', 'blowout', 'streak_3plus', etc.*

### 5. Edge Functions ‚úÖ

**judge-show**
- Judges show with Claude Sonnet 4
- Generates scores, one-liners, banter, rivalry comment, artifacts
- Calculates winner, updates database
- Sends SMS notification to first submitter (verdict_ready)
- ~$0.01-0.02 per call

**select-emcee-line**
- Selects context-appropriate Ripley line
- Weighted randomization based on game conditions
- Replaces variables ({player1}, {score}, {show_num}, etc.)
- Used for rivalry intro + show transitions
- <$0.001 per call (database query only)

**send-sms** (built, disabled pending Twilio approval)
- Notification types: your_turn, verdict_ready, manual_nudge
- Rate limiting (1 nudge per hour)
- Kill switch for cost control
- Test mode available

### 6. SMS Notifications (Built, Pending Activation) ‚ö†Ô∏è

**Infrastructure Complete:**
- Twilio integration configured
- Edge Function deployed
- Rate limiting implemented
- Kill switch for emergency shutoff
- Test mode for development

**Notification Types:**
- **your_turn:** When opponent submits (you need to answer)
- **verdict_ready:** When judging completes (first submitter notified)
- **manual_nudge:** Player clicks "Nudge" button (max 1/hour)

**Blocking Issue:**
- Awaiting Twilio A2P 10DLC registration
- Required for SMS delivery at scale
- Expected resolution: Next 1-2 weeks

**Current Workaround:**
- Real-time WebSocket updates work if app is open
- SMS would enable true async play (closed app notifications)

### 7. Legal & Infrastructure ‚úÖ

**Domain & Deployment**
- oneupper.app (live via Vercel)
- DirectNIC DNS management
- Professional email: craig@oneupper.app

**Legal Documents**
- Privacy Policy (comprehensive, attorney-reviewed)
- Terms of Service (covers UGC, AI usage, liability)
- SMS consent language (TCPA compliant)
- Supports promotional use of content with transparency

---

## What's Working Perfectly

### Real-Time Multiplayer
- No lag, instant updates when opponent acts
- Handles simultaneous actions gracefully (race conditions solved)
- Rivalry cancellation propagates immediately to both players
- Show creation conflicts (409) resolved automatically

### AI Quality
- Judge personalities are distinct and entertaining
- Scores feel fair and justified
- One-liners are punchy and in-character
- Banter flows conversationally
- Rivalry commentary adds meaningful meta-layer
- Artifacts are contextual and funny

### User Flow
- Onboarding is simple (create profile, enter code)
- Gameplay loop is tight (submit ‚Üí wait ‚Üí verdict ‚Üí next)
- No confusing states or dead ends
- Auto-advance keeps momentum
- Menu access always available

### Performance
- Fast load times
- Minimal re-renders
- Efficient database queries
- Real-time subscriptions scale well
- No memory leaks observed

---

## Known Issues & Limitations

### Minor UI Polish Needed
- Some judge one-liners occasionally exceed 12 words (AI doesn't always obey)
- Verdict screen can be dense with all content (rivalry recap + 3 artifacts + brain boost)
- Show history scrolling could paginate better (loads all shows at once)

### SMS Dependency
- Game works fine with real-time updates (app open)
- True async play requires SMS (app closed notifications)
- Blocked on Twilio A2P 10DLC registration

### Scalability Unknowns
- Not tested with 100+ concurrent users
- AI costs unknown at scale (estimated ~$10-20 per 1000 shows)
- Database performance untested under load
- Real-time subscriptions may need optimization

### Edge Cases
- What happens if rivalry reaches show 1000? (untested)
- Profile deletion doesn't clean up old shows (just marks rivalry as ended)
- If both players delete profiles simultaneously, orphaned rivalry data persists
- No graceful degradation if Edge Functions are down

---

## Development Philosophy

### Principles Followed
1. **Mobile-first, always:** Every design decision optimized for phones
2. **Real users over features:** Only build what's validated by actual usage
3. **Cost-conscious:** AI judging kept under $0.02/show, no unnecessary API calls
4. **Simplicity:** Profile codes over auth complexity, one rivalry at a time
5. **Performance:** Fast feedback loops, no artificial delays
6. **Polish matters:** Small details (confetti, streaks, micro-copy) elevate experience

### Technical Decisions
- **React + Supabase:** Fast development, real-time built-in, minimal backend code
- **JSONB for judge_data:** Flexibility for evolving AI outputs without migrations
- **Edge Functions over API routes:** Serverless, scales automatically, Supabase integration
- **Embedded arrays over DB calls:** Brain boosts, emcee lines stored in code when small
- **Database-driven when dynamic:** Emcee lines, judge profiles, prompts in Supabase

### Craig's Preferences
- Surgical code edits over full rewrites
- Comprehensive documentation for context switching
- Test systematically (two browser windows, simulate multiplayer)
- Iterate based on real usage, not speculation
- Ship small, learn fast, improve continuously

---

## What We're Thinking Next

### Immediate (After Twilio Activation)
1. **Scale to 20-50 users** (friends, family, beta testers)
2. **Gather feedback on:**
   - Which artifacts are most shareable?
   - Do people read brain boosts or skip?
   - Drop-off points (which show numbers)?
   - Judge personality favorites?
   - Rivalry longevity (how many shows typically played)?

3. **Quick wins based on feedback:**
   - Randomize artifact display (1 instead of 3)
   - Add share buttons for artifacts
   - Adjust emcee line frequencies if repetitive
   - Polish any UI friction points

### Short-Term (1-2 Months)
1. **Distribution experiments:**
   - Reddit (r/SideProject, r/webdev)
   - Product Hunt launch
   - Twitter/X posts showcasing artifacts
   - TikTok/Reels of absurd prompts + AI reactions

2. **Engagement features:**
   - Leaderboards (cross-rivalry stats)
   - More judges (expand from 25 to 50+)
   - More prompts (expand from 100 to 300+)
   - Themed prompt sets (optional filters)

3. **Retention mechanics:**
   - Achievement badges (10 shows, 20 shows, etc.)
   - Season structure (checkpoint every 20 shows with AI recap)
   - Tournament brackets (multi-rivalry competitions)

### Medium-Term (3-6 Months)
1. **Monetization exploration:**
   - Sponsor integrations (brands as judges?)
   - Premium judges/content packs
   - Shareable recap images with ads
   - In-game currency for cosmetics

2. **Advanced AI features:**
   - Deep rivalry analysis at milestones (10, 20, 40 shows)
   - Player style profiling across multiple rivalries
   - Dynamic difficulty (harder prompts for experienced players)
   - Judge memory (slight context of previous shows in season)

3. **Social features:**
   - Spectator mode (watch friends' rivalries)
   - Public leaderboards (opt-in)
   - Share individual shows to social media
   - Rivalry highlights reel (top 3 shows auto-generated)

### Long-Term (6-12 Months)
1. **Platform expansion:**
   - Native mobile apps (iOS/Android)
   - Push notifications (replace SMS)
   - Offline mode (submit when reconnected)

2. **Content marketing:**
   - Blog series: "Best One-Uppers of the Week"
   - YouTube series: "Celebrity judges react to top shows"
   - Podcast: "The One-Upper Chronicles"

3. **B2B pivot exploration:**
   - Corporate team-building tool
   - Educational version (classroom debates)
   - Conference icebreaker activations

---

## Shelved Ideas (Good, But Not Now)

### Seasons (Documented, Not Built)
**Why it's good:**
- Natural checkpoint every 20 shows
- AI-generated season summary (shareable moment)
- Creates narrative arc and retention milestone
- Foundation for leaderboards/tournaments

**Why it's shelved:**
- Adds complexity (season numbering, resets, UI changes)
- Optimizing for behavior not yet observed (no users at 20 shows)
- SMS notifications more important for retention
- Can revisit after user traction

**What we'd build instead:** Milestone celebrations (10, 20, 40 shows) with AI analysis, no season structure.

### Deep Rivalry Analysis (Spec'd, Not Built)
**Concept:** After 10/20/40 shows, generate comprehensive AI insights:
- Playing style analysis (risk-taker vs. safe player)
- Judge dynamics (which judges favor which player)
- Competitive arc (momentum shifts, comeback stories)
- Specific moments (closest show, biggest blowout)
- Forward-looking recommendations

**Why it's good:**
- Showcases AI capabilities
- Creates shareable moments
- Drives retention (motivation to hit milestones)
- Costs only ~$0.03-0.05 per analysis

**Why it's shelved:**
- Need users to validate people reach these milestones
- Requires sophisticated prompt engineering
- Uncertain engagement (might skip immediately)
- Should wait for data before building

**When to build:** After 10+ rivalries reach show 10 organically.

### Multiple Artifact Types (Ideas, Not Implemented)
- Fortune Cookie: "Your answer reveals..."
- Movie Quote: "That belongs in a Christopher Nolan film"
- Therapy Session Notes: "Patient exhibits..."
- Historical Figure: "If Abraham Lincoln said this..."
- Reddit Thread: "r/AmITheAsshole judges your answer"

**Why shelved:** Already have 3 artifact types, need to test engagement before expanding.

---

## Cost Analysis

### Per Show Costs
- **Judge AI call:** $0.01-0.02 (Claude Sonnet 4)
- **Emcee line selection:** <$0.001 (database query)
- **SMS notifications:** $0.0075 per message (Twilio)
- **Database operations:** Negligible (Supabase free tier: 500MB, 2GB bandwidth)
- **Edge Function execution:** Free tier covers thousands of calls

**Total per show:** ~$0.02-0.03 (with SMS), ~$0.01-0.02 (without)

### At Scale Projections
**1,000 active rivalries (10 shows each per month):**
- 10,000 shows/month
- AI costs: $100-200/month
- SMS costs: $150/month (2 messages per show)
- **Total: $250-350/month**

**10,000 active rivalries (10 shows each per month):**
- 100,000 shows/month
- AI costs: $1,000-2,000/month
- SMS costs: $1,500/month
- **Total: $2,500-3,500/month**

### Revenue Requirements
- Break-even at 10K rivalries: ~$3K/month revenue
- Options: Sponsorships, premium content, ad-supported recaps
- Current plan: Focus on growth, monetize later

---

## Testing Checklist (All Passing ‚úÖ)

### Profile Management
- ‚úÖ Create profile with unique code
- ‚úÖ Resume with code (cross-device)
- ‚úÖ Edit profile (name, avatar, phone, bio)
- ‚úÖ Delete profile (cleans up rivalries)
- ‚úÖ Switch between multiple profiles

### Rivalry Flow
- ‚úÖ Start rivalry by entering opponent's code
- ‚úÖ Both players see "Rivalry Started" instantly
- ‚úÖ Ripley welcome text displays with intro_emcee_text
- ‚úÖ Either player can start first show
- ‚úÖ Other player auto-navigates when first show created
- ‚úÖ Cancel rivalry (modal confirmation, both players notified)

### Gameplay
- ‚úÖ Submit answer (30-word limit enforced, live counter)
- ‚úÖ Waiting state shows cleanly (no brain boost clutter)
- ‚úÖ Real AI judging (Claude Sonnet 4, 3-5 seconds)
- ‚úÖ Verdict shows winner with randomized declaration
- ‚úÖ Both answers displayed, winner highlighted with golden mic
- ‚úÖ Judge scores show both players (segmented tabs: Scores/Chat)
- ‚úÖ Judge banter displays conversationally
- ‚úÖ Rivalry commentary appears in dedicated section
- ‚úÖ All 3 artifacts display correctly with icons
- ‚úÖ Brain boost appears: "üí° You Boosted Your Brain"
- ‚úÖ Brain boost doesn't refresh during countdown
- ‚úÖ 10-second auto-advance countdown with timer
- ‚úÖ "Stay Here" cancels countdown, shows "Continue" button
- ‚úÖ "Skip" button immediately advances
- ‚úÖ Show 2+ displays Ripley interstitial before prompt
- ‚úÖ Ripley text context-appropriate (close game, blowout, streak, etc.)
- ‚úÖ Next show loads with new prompt and judges
- ‚úÖ 409 conflict handled (both players see same show)
- ‚úÖ Confetti triggers on win (intensity based on streak)
- ‚úÖ Streak indicators (üî• at 3, 5, 10+ wins)

### Show History
- ‚úÖ Unlimited scrolling history (all shows)
- ‚úÖ Click show to view detail (Screen6)
- ‚úÖ Screen6 displays full verdict read-only
- ‚úÖ Artifacts display in show history
- ‚úÖ Brain boost displays in show history (random each view)
- ‚úÖ Back to Game navigation works

### Real-Time Sync
- ‚úÖ Opponent submission detected instantly
- ‚úÖ Judging completion triggers verdict for both players
- ‚úÖ Rivalry cancellation propagates immediately
- ‚úÖ Race conditions handled (simultaneous show creation)
- ‚úÖ No polling, all event-driven updates

### Edge Functions
- ‚úÖ judge-show: Scores, banter, artifacts, rivalry comment all generate
- ‚úÖ select-emcee-line: Context detection, variable replacement works
- ‚úÖ send-sms: Built and tested (disabled pending Twilio approval)

---

## Files & Structure

### Key Components
```
src/
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ Screen1.jsx         # Profile creation, rivalry start
‚îÇ   ‚îú‚îÄ‚îÄ Screen2.jsx         # Profile management
‚îÇ   ‚îú‚îÄ‚îÄ Screen4.jsx         # Main gameplay loop
‚îÇ   ‚îú‚îÄ‚îÄ Screen6.jsx         # Show history detail
‚îÇ   ‚îú‚îÄ‚îÄ Header.jsx          # Persistent header
‚îÇ   ‚îú‚îÄ‚îÄ HowToPlayModal.jsx  # Tutorial modal
‚îÇ   ‚îî‚îÄ‚îÄ InterstitialScreen.jsx # Ripley interstitials
‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îú‚îÄ‚îÄ codeGenerator.js    # Profile code generation
‚îÇ   ‚îî‚îÄ‚îÄ prompts.js          # DB queries for prompts/judges
‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îî‚îÄ‚îÄ supabase.js         # Supabase client
‚îî‚îÄ‚îÄ App.jsx                 # Routing logic
```

### Edge Functions (Supabase)
```
supabase/functions/
‚îú‚îÄ‚îÄ judge-show/             # AI judging with Claude Sonnet 4
‚îú‚îÄ‚îÄ select-emcee-line/      # Ripley line selection
‚îî‚îÄ‚îÄ send-sms/               # Twilio SMS notifications
```

### Documentation
```
PROJECT-STATUS.md           # This document
MILESTONE-ANALYSIS.md       # Shelved: Deep rivalry analysis spec
SEASONS.md                  # Shelved: Season structure spec
```

---

## Quick Reference

**Live URL:** https://oneupper.app  
**Status:** Production, awaiting Twilio for SMS  
**Current Users:** 2 (Craig testing with 2 profiles)  
**Tech Stack:** React + Supabase + Claude Sonnet 4 + Vercel  
**Cost per Show:** ~$0.01-0.02 (AI only), ~$0.02-0.03 (with SMS)  

**Color Palette:**
- Background: `slate-900` ‚Üí `slate-800` gradient
- Text: `slate-100` / `slate-200` / `slate-300` / `slate-400`
- Accent: `orange-500`
- Borders: `slate-600`

**Database Tables:** profiles, rivalries, shows, prompts, judges, emcee_lines

**Profile Code Format:** ADJECTIVE-NOUN-#### (e.g., HAPPY-TIGER-1234)

**Judge Structure:** 25 personalities, 3 per show, score 1-10 each

**Show Flow:** Prompt ‚Üí Answer (30 words) ‚Üí Judging (3s) ‚Üí Verdict ‚Üí Next

**Real-Time:** WebSocket subscriptions via Supabase (no polling)

---

## Next Session Continuation Prompt
```
Hi! We're building One-Upper, a 1v1 async competitive game. Production-ready at 
oneupper.app, awaiting Twilio SMS approval before scaling.

Current State: All features complete (gameplay, AI judging, Ripley emcee, artifacts, 
brain boosts). SMS built but disabled. Zero users besides testing.

Shelved for Later: Seasons, milestone analysis (waiting for user traction data).

Next Focus: [Specify what you want to work on]

Files needed: [List based on focus area]

Last Updated: November 23, 2024
Version: 2.0 (Post-Ripley, Post-Artifacts, Post-Brain Boosts)
Maintainer: Craig (craig@oneupper.app)